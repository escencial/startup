<!DOCTYPE html>
<html>

	<header>

		<title></title>
		<style>
			#holder { border: 10px dashed #ccc; width: 300px; height: 300px; margin: 20px auto;}
			#holder.hover { border: 10px dashed #333; }
		</style>

	</header>

	<body>
		
		<p class="status"></p>
		<textarea class= "storageme" id="holder"></textarea>
		<button class="add">add</button>
		
		<ul class="indexeddb"></ul>

		<p> water effect </p>
		<canvas id="canvas"></canvas>

		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
		<script type="text/javascript">
			/**
			 * localStorage
			 */
			$(function(){
				// get val from localStorage
				$(".storageme").val(localStorage.getItem("text"));
			});
			$(".storageme").on('keypress', function() {
				// set val in localStorage
				localStorage.setItem("text", $(this).val());
			});

			/**
			 * IndexedDb
			 */
			var openRequest = indexedDB.open("db", 1);
			var db = {};
			openRequest.onsuccess = function (e) { 
				db = e.target.result;
			};
			openRequest.onupgradeneeded = function (e) {
				db = e.target.result;
				db.createObjectStore("os", {autoIncrement:true});
			};
			$(function () {

				$('.add').on('click', function () {
					$('.indexeddb').html('');
					var transaction = db.transaction(['os'], 'readwrite');
					var store = transaction.objectStore("os");
					var add = store.put({'text': $('.storageme').val() });
					store.openCursor().onsuccess = function(e) {
						var cursor = e.target.result;
						if (cursor) {
							for(var field in cursor.value) {
								$('.indexeddb').append($('<li>').html(cursor.value[field]));
							}
	            cursor.continue();
						}
					}
				});
			});

			/**
			 * Drag & Drop
			 */
			var holder = document.getElementById('holder');
			holder.ondrop = function (e) {
			  e.preventDefault();
			  var file = e.dataTransfer.files[0],
			  reader = new FileReader();
			  reader.onload = function (event) {
			    holder.value = event.target.result;
			    $('.storageme').trigger('keypress');
			  };
			  reader.readAsText(file,"UTF-8");

			  return false;
			};

			/**
			 * Animate
			 */
			var canvas  = document.getElementById("canvas");
			var ctx = canvas.getContext("2d");

			var x =  getRam(100, 200);
			var y = getRam(1, 80);
			var speed = 15;

			function animate() {
			    requestAnimationFrame(animate);
			    x += speed;
			    if (x <= 0 || x >= canvas.width){
			        speed = -speed;
			    }
					var draw = function () {
					    ctx.clearRect(0 , 0, 500, getRam(1, 100));
					    ctx.fillStyle = "blue";
					    ctx.fillRect(x, y, getRam(1, 50), getRam(1, 100));
					}();
			}

			function getRam (min, max) {
				return Math.floor((Math.random() * max) + min);
			}

			animate();
		</script>
	</body>
<html>