<!DOCTYPE html>
<html>
	<header>
		<title></title>
	</header>
	<body>
		<textarea class= "storageme"></textarea>
		<button class="cosas">cosas</button>
		<ul class="indexeddb"></ul>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
		<script type="text/javascript">
			/**
			 * localStorage
			 */
			$(function(){
				// get val from localStorage
				$(".storageme").val(localStorage.getItem("text"));
			});
			$(".storageme").on('keypress', function() {
				// set val in localStorage
				localStorage.setItem("text", $(this).val());
			});
			/**
			 * IndexedDb
			 */
			var openRequest = indexedDB.open("db", 1);
			var db = {};
			openRequest.onsuccess = function (e) { 
				db = e.target.result;
			};
			openRequest.onupgradeneeded = function (e) {
				db = e.target.result;
				db.createObjectStore("os", {autoIncrement:true});
			};
			$(function () {
				$('.cosas').on('click', function () {
					$('.indexeddb').html('');
					var transaction = db.transaction(['os'], 'readwrite');
					var store = transaction.objectStore("os");
					var add = store.put({'text': $('.storageme').val() });
					store.openCursor().onsuccess = function(e) {
						var cursor = e.target.result;
						if (cursor) {						
							for(var field in cursor.value) {
								$('.indexeddb').append($('<li>').html(cursor.value[field]));
							}
	            cursor.continue();
						}
					}
				});
			});
		</script>
	</body>
<html>